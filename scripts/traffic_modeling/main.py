import snap
from traffic_model import TrafficModel

e_file = open("../n_sf_edges.txt", 'r')
n_file = open("../n_sf_nodes.txt", 'r')
# maps from the pair of source and destination nodes to typology and speed
# ex. (33242031 65292114) -> "primary"
# ex. (33242031 65292114) -> "25"(or "N/A")
edge_typo = {}
edge_speed = {}
edge_lanes = {}
nd_to_e = {}
# maps from the node idea to its coordinates
nodes = {}
graph = {}

for line in e_file:
    ids = line.rstrip().split()
    if ids[0] == ids[1]:
        continue
    if (int(ids[0]), int(ids[1])) == (14282, 10113):
        continue
    e1 = int(ids[0])
    e2 = int(ids[1])
    if e1 not in graph:
        graph[e1] = []
    if e2 not in graph:
        graph[e2] = []

    graph[e1].append(e2)
    if ids[6] == "no":
        graph[e2].append(e1)
        edge_typo[(int(ids[1]), int(ids[0]))] = ids[3]
        edge_speed[(int(ids[1]), int(ids[0]))] = ids[4]
        edge_lanes[(int(ids[1]), int(ids[0]))] = ids[5]
        nd_to_e[(int(ids[1]), int(ids[0]))] = int(ids[2])

    edge_typo[(int(ids[0]), int(ids[1]))] = ids[3]
    edge_speed[(int(ids[0]), int(ids[1]))] = ids[4]
    edge_lanes[(int(ids[0]), int(ids[1]))] = ids[5]
    nd_to_e[(int(ids[0]), int(ids[1]))] = int(ids[2])

for line in n_file:
    data = line.rstrip().split()
    nodes[int(data[0])] = (float(data[1]), float(data[2]))

# init_pairs = [(13186, 3438), (4200, 7354), (13841, 2997), (6143, 10526), (12107, 618), (4851, 11304), (9280, 3315), (2858, 8702), (11843, 6433), (11093, 11317), (754, 3938), (6558, 9646), (3292, 2519), (1571, 10925), (11234, 14029), (11699, 14562), (9697, 3209), (4329, 12329), (13003, 10884), (2235, 2127), (11607, 6857), (443, 6146), (1633, 2051), (12266, 13016), (4678, 14387), (15097, 1012), (9149, 3612), (910, 862), (1177, 4686), (955, 912), (12110, 6679), (1885, 7765), (10370, 5633), (14480, 613), (11676, 1431), (5835, 1978), (8037, 4077), (12923, 11719), (10281, 7713), (11287, 13429), (8725, 13143), (8671, 15055), (7884, 2381), (2773, 6551), (11659, 14357), (5965, 2594), (513, 5045), (3346, 4854), (2218, 755), (1940, 4493), (4406, 5226), (417, 5893), (11329, 9198), (12759, 7280), (7925, 14675), (2462, 2948), (9932, 4017), (14570, 11100), (8916, 14486), (7062, 3418), (1370, 10237), (1992, 14458), (5042, 9618), (6876, 6043), (11554, 11460), (13279, 13232), (5882, 9727), (1664, 11739), (9907, 3284), (10980, 7951), (14253, 5078), (14651, 2072), (4756, 3872), (6581, 3541), (11283, 10792), (12516, 3583), (4203, 14369), (1821, 4072), (6145, 6688), (980, 14570), (9702, 14256), (13618, 3645), (2414, 11195), (7310, 3903), (3301, 12625), (10246, 8655), (4180, 10008), (5512, 2767), (3886, 6490), (8956, 1308), (13131, 11650), (5396, 10202), (1277, 13968), (11694, 12455), (12818, 9982), (13701, 9665), (8205, 6209), (9653, 7664), (9731, 220), (11632, 1156), (3400, 11788), (2673, 3626), (5262, 2670), (12795, 5527), (11106, 2211), (5167, 5782), (8797, 14278), (5621, 8717), (10945, 8868), (12087, 3265), (14197, 8324), (8095, 11836), (5928, 2797), (2875, 4611), (10237, 4492), (12443, 11744), (13788, 13812), (14009, 14039), (12655, 18), (8136, 7047), (12733, 2144), (3503, 8094), (1313, 8158), (7548, 560), (9102, 1845), (10135, 11028), (281, 13987), (10943, 14086), (1597, 9522), (7939, 5354), (10023, 4930), (11118, 7680), (12872, 8043), (11813, 5158), (6468, 4740), (11076, 170), (983, 6110), (7015, 3969), (9201, 595), (5695, 12662), (4846, 10839), (12381, 10676), (3689, 1489), (5177, 12801), (12366, 1421), (11659, 8954), (4975, 5659), (2449, 14434), (8341, 13549), (8721, 14564), (180, 9224), (11936, 3571), (7573, 4042), (1549, 4325), (13569, 8277), (539, 13793), (14043, 9415), (4765, 4013), (13571, 14918), (8263, 11102), (9457, 7532), (12110, 1979), (12006, 15022), (11179, 2160), (13662, 8797), (11887, 8812), (7974, 12171), (12620, 2513), (3791, 1880), (8660, 8770), (6227, 2779), (7227, 3081), (2212, 8926), (2720, 4280), (9106, 10859), (13978, 269), (6993, 5166), (3424, 13593), (2321, 5025), (3508, 6181), (8616, 1067), (10846, 1728), (8257, 6576), (970, 2557), (14918, 894), (3860, 10458), (9389, 5774), (1571, 7685), (11103, 5562), (10375, 13268), (6267, 6327), (7392, 9852), (9822, 8958), (10661, 12677), (761, 2416), (13869, 12982), (7333, 6771), (453, 7066), (3738, 11810), (10958, 3982), (12366, 4345), (6310, 3354), (9091, 5960), (5690, 12561), (10471, 14841), (9965, 9710), (6295, 1123), (13928, 2880), (9951, 8942), (6530, 11141), (4029, 11764), (2500, 127), (2691, 12453), (10958, 2264), (5209, 948), (13752, 2649), (11178, 1114), (13239, 12130), (12350, 12898), (9993, 12179), (8648, 2222), (5610, 506), (7657, 11026), (8133, 3013), (12295, 10031), (9297, 2175), (13243, 2024), (433, 705), (13768, 4828), (9772, 14856), (1079, 7068), (4507, 4706), (3560, 14445), (9050, 4413), (14744, 7506), (13160, 9439), (4390, 3498), (1924, 8788), (7273, 9159), (1731, 8011), (9845, 571), (3059, 14108), (8352, 5739), (8600, 13040), (9228, 3013), (13574, 633), (12010, 1295), (6357, 4191), (10734, 3611), (6329, 7912), (4647, 5629), (9173, 12119), (12028, 7257), (5355, 14585), (2432, 6808), (9844, 625), (3452, 883), (7833, 3062), (1581, 12375), (6743, 3443), (11928, 13990), (978, 10659), (3644, 13934), (2430, 9957), (5738, 13377), (14068, 11643), (544, 1016), (12809, 12535), (3251, 14723), (205, 3068), (10021, 7664), (3738, 9113), (4815, 11212), (8795, 13715), (14492, 77), (14388, 9874), (7051, 2181), (7669, 10522), (12284, 8692), (7218, 10088), (11206, 5521), (3622, 382), (9159, 832), (7680, 13674), (282, 12195), (7215, 12902), (7128, 8797), (10392, 5681), (5456, 12254), (4609, 1880), (9120, 1141), (1235, 4487), (8835, 12376), (5146, 1219), (12211, 845), (12324, 4155), (3016, 9178), (10515, 7641), (1172, 10879), (3424, 9689), (12797, 3524), (13302, 2915), (3827, 2052), (1944, 3219), (5498, 10571), (1252, 11929), (11052, 13609), (4805, 6635), (4897, 9747), (1357, 1875), (1689, 14146), (4221, 91), (3724, 9786), (356, 2991), (13121, 12401), (7446, 2459), (2522, 1614), (9753, 7304), (4604, 7262), (11232, 7378), (14551, 6334), (7633, 6794), (9122, 6446), (10721, 6830), (11048, 3085), (4092, 6486), (716, 14708), (14018, 9066), (4358, 8109), (733, 1832), (9677, 6440), (11158, 244), (13129, 9531), (792, 7709), (293, 9986), (7463, 11057), (9721, 5255), (4601, 12182), (1416, 490), (11125, 3010), (458, 12390), (9257, 7401), (6228, 11878), (14753, 3117), (14312, 7895), (2283, 14693), (10691, 1508), (2053, 5165), (2945, 6630), (14982, 11629), (11639, 14855), (14807, 10318), (302, 10238), (7517, 5692), (11445, 11760), (13996, 10079), (10994, 11912), (13654, 2936), (12999, 12442), (9125, 192), (11000, 7217), (6579, 9568), (12394, 1069), (2455, 6336), (1424, 9963), (688, 3905), (14242, 1562), (3050, 14838), (7179, 4450), (11610, 14858), (9999, 1109), (13668, 8988), (7004, 4739), (11987, 9343), (9786, 1227), (923, 13318), (6654, 13404), (13622, 4832), (9552, 5876), (1360, 7639), (2215, 9014), (2354, 6071), (7858, 691), (6298, 8136), (8123, 14433), (11496, 4669), (1258, 14035), (13717, 11317), (7467, 7258), (9618, 14073), (2309, 9969), (4641, 1067), (4895, 14481), (5631, 2426), (10352, 1308), (5937, 5623), (4957, 2986), (10622, 14223), (14819, 3155), (5879, 4568), (13993, 12582), (9441, 5376), (10107, 9725), (6105, 13966), (8296, 2083), (14279, 1424), (4929, 10852), (12547, 9254), (4310, 4314), (11005, 14839), (2107, 13234), (8900, 12074), (12297, 10830), (8130, 1806), (3743, 3510), (14915, 2741), (7661, 8064), (10658, 8002), (2490, 5758), (2526, 4262), (6213, 11643), (321, 4585), (1109, 6591), (13125, 4562), (11468, 10219), (8340, 6070), (5081, 8837), (13298, 9802), (11858, 6915), (10118, 5392), (11434, 2801), (9540, 14411), (14307, 5475), (9187, 8607), (11092, 8869), (14703, 9518), (1189, 2056), (420, 3844), (3797, 1387), (8772, 8323), (5883, 9025), (9203, 14046), (14536, 6489), (1884, 12166), (1292, 2647), (9306, 14895), (12884, 11867), (1812, 5796), (3161, 1356), (10756, 5417), (6695, 14628), (15095, 10058), (4001, 487), (6352, 7816), (13315, 13092), (9624, 2620), (7503, 8617), (2278, 14262), (13196, 7411), (5780, 10816), (8133, 14196), (9429, 11172), (7, 13546), (6690, 13357), (9777, 6373), (12068, 3083), (14052, 9543), (10793, 14690), (11494, 3608), (7752, 7507), (14645, 6753), (8555, 14607), (4168, 9029), (12391, 174), (7139, 4216), (8549, 13586), (2164, 12094), (8733, 6189), (12824, 2510), (2701, 8718), (68, 6814), (8029, 10030), (9988, 3331), (10974, 9739), (10832, 1176), (5490, 14117), (2623, 634), (4177, 2445), (2053, 6283), (4196, 2957), (840, 14706), (833, 13514), (8307, 4895), (703, 3471), (10548, 14104), (6836, 8643), (10296, 13545), (812, 1386), (6707, 742), (6093, 3005), (10224, 410), (2279, 14518), (3131, 14728), (11542, 6690), (7058, 7865), (5772, 11491), (657, 4615), (12455, 11392), (12223, 4734), (6715, 13292), (1157, 7837), (1746, 7373), (3082, 2577), (7997, 3419), (2763, 5432), (13398, 8496), (879, 8364), (7608, 13045), (7874, 11809), (1872, 387), (3860, 4357), (3194, 12294), (11473, 4308), (12118, 10719), (9412, 7088), (4106, 1159), (4275, 11510), (8205, 626), (3174, 7079), (12706, 4240), (9912, 11829), (12787, 8177), (4921, 6521), (6132, 11981), (2436, 5548), (6406, 9900), (10819, 917), (4648, 11003), (12335, 5376), (4873, 443), (11421, 647), (1664, 12465), (12160, 10735), (8363, 10620), (12428, 4448), (6405, 2144), (5274, 8441), (871, 1762), (424, 7591), (4505, 7565), (11090, 53), (4220, 8399), (5545, 7409), (14388, 3527), (9987, 5085), (14228, 777), (13245, 9366), (62, 9092), (1335, 6711), (3997, 12412), (11402, 6717), (10019, 8058), (14650, 9174), (7730, 1705), (7760, 4273), (2623, 1997), (6358, 13180), (5183, 12914), (4191, 175), (1381, 13680), (6886, 11123), (1794, 5204), (7453, 5200), (8732, 5707), (540, 14490), (11938, 12141), (5380, 8706), (5901, 11339), (4529, 232), (4159, 2040), (3761, 5613), (452, 7840), (8243, 8297), (7651, 4480), (15062, 9230), (5238, 1001), (11621, 6713), (6108, 14830), (6772, 3594), (4544, 6841), (414, 3299), (4192, 10270), (6925, 8209), (6008, 3817), (8782, 3432), (6418, 7998), (13882, 14925), (172, 7816), (7492, 2460), (12398, 9427), (7902, 11445), (9775, 13288), (8627, 972), (8940, 12968), (3537, 14082), (11662, 8709), (2599, 4039), (6141, 12907), (5047, 14044), (1915, 4385), (3798, 5113), (3851, 2623), (10913, 3452), (4606, 14179), (14854, 15051), (7951, 627), (10869, 4092), (11563, 773), (1785, 4501), (9806, 12025), (5966, 4284), (5207, 13694), (2863, 8647), (8389, 4669), (448, 14074), (549, 12887), (5385, 5124), (13095, 4369), (1288, 11660), (7171, 2658), (6367, 4375), (4877, 1125), (5343, 11797), (6158, 11552), (739, 10820), (1604, 1080), (5311, 2149), (3349, 8839), (7663, 7830), (9943, 1891), (393, 6425), (597, 12611), (10038, 3507), (6097, 14970), (5765, 10575), (14306, 7768), (8840, 8679), (12438, 13220), (1989, 12518), (9708, 5402), (6420, 6401), (13029, 8325), (2002, 11021), (5572, 6653), (14907, 2686), (3405, 9036), (13883, 3526), (6540, 6049), (2551, 14927), (10445, 2370), (3794, 5317), (13274, 12319), (13834, 271), (7022, 2688), (11682, 7111), (12641, 1612), (7043, 1825), (5772, 12865), (7257, 1291), (13062, 8680), (1964, 9690), (1033, 12939), (4043, 9796), (3786, 11834), (3748, 12827), (4826, 7525), (642, 585), (12808, 9884), (14213, 7686), (1174, 1031), (7183, 8058), (5430, 7700), (2435, 8294), (8909, 14798), (2877, 9549), (11391, 14394), (9333, 3790), (5696, 14721), (1484, 12595), (12386, 6378), (10481, 14865), (8055, 10339), (10324, 4274), (5457, 10154), (11210, 1399), (7201, 4606), (8583, 9870), (2804, 2764), (14496, 4697), (2058, 10444), (9953, 895), (1322, 4515), (5420, 9805), (6987, 11969), (8471, 685), (1672, 1525), (11028, 5998), (1320, 10316), (10419, 13925), (2634, 11460), (12759, 2329), (8413, 1156), (421, 3433), (11263, 5240), (4791, 9984), (8345, 14679), (8297, 3362), (8786, 3311), (9123, 7142), (12999, 10970), (644, 12664), (10420, 7481), (5519, 5780), (7900, 11367), (2352, 11851), (3494, 5293), (4849, 1577), (12346, 7579), (5455, 7636), (6843, 6765), (3293, 2946), (14029, 1972), (3980, 3486), (10962, 12018), (8034, 14014), (2383, 4818), (10592, 10123), (10912, 9349), (2146, 6860), (4615, 591), (12848, 12422), (652, 9580), (4629, 1671), (5166, 638), (2508, 6141), (10366, 4490), (9390, 13943), (9368, 3221), (9942, 1224), (11288, 10550), (91, 1215), (11790, 2148), (11700, 9277), (3790, 6703), (5039, 6570), (4643, 9841), (11076, 577), (11984, 11849), (12780, 5649), (13134, 13214), (8790, 8613), (7996, 550), (9218, 3381), (14194, 2034), (348, 4104), (691, 829), (1134, 2373), (13621, 15022), (6575, 6945), (4470, 9871), (2008, 11639), (4724, 5390), (88, 3155), (9775, 15053), (9111, 8168), (10216, 7155), (3435, 1013), (13695, 10267), (4723, 2807), (15078, 2516), (5598, 6466), (4198, 1998), (2845, 9264), (14864, 15016), (12247, 14172), (12939, 2806), (4773, 14416), (5041, 1656), (4558, 3247), (12112, 2189), (13802, 9277), (1959, 4547), (134, 1486), (5207, 13832), (13222, 1357), (1337, 4625), (1142, 13839), (12259, 5087), (7691, 7307), (9046, 9569), (6395, 4497), (4411, 3578), (12231, 11056), (14389, 1632), (1623, 8609), (12875, 13226), (6441, 2261), (12580, 7974), (3384, 11727), (6538, 6540), (11972, 12915), (11178, 5027), (5120, 3834), (10068, 7278), (10872, 3567), (11969, 2641), (9402, 10762), (8224, 9929), (3510, 7908), (12834, 8516), (14261, 272), (9926, 4439), (2691, 13037), (14171, 12056), (6679, 4664), (10660, 1698), (1029, 7327), (13, 3639), (9147, 3556), (6373, 12067), (862, 2044), (1160, 2544), (12091, 5508), (857, 12780), (10093, 1573), (4848, 14566), (5404, 7046), (8532, 6301), (11575, 9834), (4909, 14598), (5335, 10085), (5249, 10785), (3308, 11514), (6965, 6760), (14077, 5915), (11829, 10186), (513, 6841), (8260, 14341), (8668, 8792), (9796, 11103), (940, 14660), (12716, 6423), (1019, 11312), (11537, 83), (13139, 1772), (8194, 5129), (12178, 4056), (12325, 5439), (1928, 6682), (1789, 7192), (2486, 13400), (13593, 12180), (566, 11535), (76, 3999), (6108, 4910), (10509, 4239), (2602, 3875), (5233, 5602), (11362, 590), (5105, 4139), (14005, 7997), (14605, 8048), (4635, 8045), (14582, 11859), (9039, 13784), (8236, 11501), (14667, 9574), (3367, 13445), (6656, 1373), (13541, 5751), (3925, 8839), (8767, 10542), (163, 7290), (14943, 755), (14755, 1105), (12458, 3141), (8004, 5433), (1762, 12261), (10912, 14734), (8268, 14760), (6694, 14342), (512, 11215), (8927, 4392), (11624, 6876), (8647, 483), (547, 11271), (7896, 14202), (9903, 755), (9809, 8546), (11174, 6552), (7736, 8618), (1177, 7709), (8197, 2467), (4284, 1120), (1963, 12075), (2738, 8150), (9961, 9984), (6376, 12079), (4246, 362), (8523, 14593), (13289, 6684), (7096, 9881), (10401, 13909), (7714, 6447), (7162, 12370), (7662, 9950), (13966, 9201), (10693, 428), (3018, 4758), (14457, 14507), (13287, 9364), (293, 9645), (10205, 7245), (629, 13425), (1066, 4047), (11247, 11220), (11717, 10032), (14447, 8130), (4154, 10844), (368, 10572), (11446, 14427), (13283, 6822), (2289, 2689), (1727, 11857), (3038, 7337), (2637, 8671), (1762, 9441), (14492, 14431), (7935, 8756), (6725, 950), (11689, 594), (989, 3838), (12591, 10675), (5561, 4668), (14562, 7854), (207, 8095), (13271, 11922), (10752, 12664), (1687, 708), (5216, 899), (2533, 4519), (3362, 14195), (4381, 918), (5610, 15010), (6246, 1882), (12368, 4808), (11434, 11857), (11708, 2188), (8635, 5399), (6002, 9837), (4110, 4999), (13159, 8994), (62, 14144), (3096, 11437), (1709, 11223), (6837, 13599), (8628, 377), (1357, 11715), (1547, 12093), (14812, 3322), (5690, 12578), (2068, 12260), (6616, 13223), (12559, 11920), (11840, 2245), (14996, 700), (3685, 5941), (9107, 3966), (5534, 10250), (5787, 2604), (12141, 7354), (11915, 5089), (12438, 11956), (12285, 2601), (8696, 2370), (13607, 868), (8487, 4218), (8026, 6651), (5880, 5053), (11257, 4506), (14521, 9956), (11149, 129), (15092, 8426), (5614, 7363), (15098, 12645), (14243, 11119), (1092, 5456), (9337, 3758), (10003, 11397), (1730, 10951)]
init_pairs = []

G = snap.LoadEdgeList(snap.PUNGraph, '../n_sf_edges.txt', 0, 1)
# model = TrafficModel(G,graph, nodes, edge_typo, edge_speed, edge_lanes, nd_to_e)
# model.iterate(20, 100)

candidates = [7863, 9460, 7702, 8781, 3716, 345, 3717, 3263, 4469, 4470, 7698, 4658, 8743]
for e in nd_to_e:
    if nd_to_e[e] in candidates:
        graph[e[0]].remove(e[1])

model = TrafficModel(G, graph, nodes, edge_typo, edge_speed, edge_lanes, nd_to_e, init_pairs)
model.iterate(20, 1000)
